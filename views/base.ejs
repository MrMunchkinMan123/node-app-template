<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'FitTracker - Your Fitness Journey' %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    ğŸ’ª FitTracker
                </div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="/dashboard" id="nav-dashboard">ğŸ“Š Dashboard</a></li>
                        <li><a href="/workout" id="nav-workout">ğŸ‹ï¸ Workout</a></li>
                        <li><a href="/progress" id="nav-progress">ğŸ“ˆ Progress</a></li>
                        <li><a href="/community" id="nav-community">ğŸ‘¥ Community</a></li>
                        <li><a href="/achievements" id="nav-achievements">ğŸ† Achievements</a></li>
                        <li><a href="/profile" id="nav-profile">âš™ï¸ Profile</a></li>
                    </ul>
                </nav>
                <div class="user-info">
                    <span id="username-display">Loading...</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <%- body %>
        </div>
    </main>

    <script>
        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                window.location.href = '/';
                return false;
            }
            return true;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('jwtToken');
            localStorage.removeItem('userName');  // Changed from 'username' to 'userName'
            window.location.href = '/';
        }

        // Load user info
        function loadUserInfo() {
            const userName = localStorage.getItem('userName');  // Changed from 'username' to 'userName'
            if (userName) {
                document.getElementById('username-display').textContent = `ğŸ‘¤ ${userName}`;
            } else {
                document.getElementById('username-display').textContent = 'ğŸ‘¤ User';
            }
        }

        // Set active nav item
        function setActiveNav(pageId) {
            const navItem = document.getElementById('nav-' + pageId);
            if (navItem) {
                navItem.classList.add('active');
            }
        }

        // Initialize on page load
        if (checkAuth()) {
            loadUserInfo();
        }
    </script>
</body>
</html>
