<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTracker - Your Fitness Journey</title>
    <style>
        :root {
            /* Color scheme from provided data aaaaa*/
            --primary: #2563eb;
            --secondary: #10b981;
            --accent: #f59e0b;
            --background: #f8fafc;
            --text: #1f2937;
            --border: #e5e7eb;
            --card-bg: #ffffff;
            --error: #dc2626;
            --success: #059669;
            --warning: #d97706;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-menu a:hover {
            background: rgba(255,255,255,0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Login/Register Page Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .auth-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: var(--border);
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
        }

        .auth-tab:first-child {
            border-radius: 5px 0 0 5px;
        }

        .auth-tab:last-child {
            border-radius: 0 5px 5px 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #1d4ed8;
        }

        .btn:disabled {
            background: var(--border);
            cursor: not-allowed;
        }

        .error-message {
            background: #fee2e2;
            color: var(--error);
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border: 1px solid #fecaca;
        }

        .success-message {
            background: #d1fae5;
            color: var(--success);
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border: 1px solid #a7f3d0;
        }

        /* Main App Layout */
        .app-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 2rem 0;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 2rem;
            color: var(--text);
            text-decoration: none;
            transition: background 0.3s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: var(--primary);
            color: white;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            background: var(--background);
        }

        /* Page Styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text);
            opacity: 0.8;
        }

        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .grid {
            display: grid;
            gap: 2rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .workout-form {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .exercise-entry {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
            padding: 1rem;
            background: var(--background);
            border-radius: 5px;
        }

        .remove-exercise {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .add-exercise {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text);
            opacity: 0.7;
        }

        .achievement-badge {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent) 0%, #fbbf24 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .badge-icon {
            font-size: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.3s;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .sidebar-nav {
                display: flex;
                overflow-x: auto;
                padding: 0 1rem;
            }

            .sidebar-nav li {
                margin-bottom: 0;
                margin-right: 0.5rem;
                white-space: nowrap;
            }

            .main-content {
                order: 1;
                padding: 1rem;
            }

            .exercise-entry {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login/Register Page -->
    <div id="auth-page" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>üèãÔ∏è FitTracker</h1>
                <p>Your Personal Fitness Journey</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
            </div>

            <div id="auth-error" class="error-message hidden"></div>
            <div id="auth-success" class="success-message hidden"></div>

            <!-- Login Form -->
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="hidden">
                <div class="form-group">
                    <label for="register-name">Full Name</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="register-confirm">Confirm Password</label>
                    <input type="password" id="register-confirm" required>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        üèãÔ∏è FitTracker
                    </div>
                    <nav class="nav-menu">
                        <a href="#" onclick="navigateTo('dashboard')">üè† Dashboard</a>
                        <a href="#" onclick="navigateTo('workout-tracker')">üí™ Workouts</a>
                        <a href="#" onclick="navigateTo('progress')">üìä Progress</a>
                        <a href="#" onclick="navigateTo('community')">üë• Community</a>
                    </nav>
                    <div class="user-info">
                        <span id="user-welcome">Welcome, User!</span>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- App Container -->
        <div class="app-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <ul class="sidebar-nav">
                    <li><a href="#" class="active" onclick="navigateTo('dashboard')">üè† Dashboard</a></li>
                    <li><a href="#" onclick="navigateTo('workout-tracker')">üí™ Workout Tracker</a></li>
                    <li><a href="#" onclick="navigateTo('progress')">üìä Progress</a></li>
                    <li><a href="#" onclick="navigateTo('community')">üë• Community</a></li>
                    <li><a href="#" onclick="navigateTo('achievements')">üèÜ Achievements</a></li>
                    <li><a href="#" onclick="navigateTo('profile')">‚öôÔ∏è Profile</a></li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="page-header">
                        <h1>Dashboard</h1>
                        <p>Welcome back! Here's your fitness overview.</p>
                    </div>

                    <div id="profile-loading" class="loading">Loading profile information...</div>
                    <div id="profile-content" class="hidden">
                        <div class="grid grid-3">
                            <div class="stat-card">
                                <div class="stat-value" id="total-workouts">0</div>
                                <div>Total Workouts</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="current-streak">0</div>
                                <div>Day Streak</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="total-exercises">0</div>
                                <div>Exercises Completed</div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>Recent Activity</h3>
                            <div id="recent-workouts">
                                <p>No recent workouts found. Start your fitness journey today!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workout Tracker Page -->
                <div id="workout-tracker-page" class="page">
                    <div class="page-header">
                        <h1>Workout Tracker</h1>
                        <p>Log your exercises and track your progress.</p>
                    </div>

                    <div class="card">
                        <h3>Create New Workout</h3>
                        <form id="workout-form" class="workout-form">
                            <div class="form-group">
                                <label for="workout-name">Workout Name</label>
                                <input type="text" id="workout-name" placeholder="e.g., Upper Body Strength" required>
                            </div>
                            
                            <div id="exercises-container">
                                <h4>Exercises</h4>
                                <div class="exercise-entry">
                                    <div class="form-group">
                                        <label>Exercise</label>
                                        <select class="exercise-select" required>
                                            <option value="">Select Exercise</option>
                                            <option value="Push-ups">Push-ups</option>
                                            <option value="Pull-ups">Pull-ups</option>
                                            <option value="Bench Press">Bench Press</option>
                                            <option value="Squats">Squats</option>
                                            <option value="Deadlifts">Deadlifts</option>
                                            <option value="Bicep Curls">Bicep Curls</option>
                                            <option value="Shoulder Press">Shoulder Press</option>
                                            <option value="Plank">Plank</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Sets</label>
                                        <input type="number" class="sets-input" min="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Reps</label>
                                        <input type="number" class="reps-input" min="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Weight (lbs)</label>
                                        <input type="number" class="weight-input" min="0" step="0.5">
                                    </div>
                                    <button type="button" class="remove-exercise" onclick="removeExercise(this)">√ó</button>
                                </div>
                            </div>
                            
                            <button type="button" class="add-exercise" onclick="addExercise()">+ Add Exercise</button>
                            <button type="submit" class="btn">Save Workout</button>
                        </form>
                    </div>

                    <div class="card">
                        <h3>Workout History</h3>
                        <div id="workout-history">
                            <div class="loading">Loading workout history...</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Page -->
                <div id="progress-page" class="page">
                    <div class="page-header">
                        <h1>Progress Analytics</h1>
                        <p>Visualize your fitness journey with detailed analytics.</p>
                    </div>

                    <div class="grid grid-2">
                        <div class="card">
                            <h3>Workout Frequency</h3>
                            <div style="height: 200px; background: var(--background); border-radius: 5px; display: flex; align-items: center; justify-content: center; color: var(--text); opacity: 0.5;">
                                üìä Chart Placeholder - Workouts per Week
                            </div>
                        </div>
                        <div class="card">
                            <h3>Strength Progress</h3>
                            <div style="height: 200px; background: var(--background); border-radius: 5px; display: flex; align-items: center; justify-content: center; color: var(--text); opacity: 0.5;">
                                üìà Chart Placeholder - Weight Progress
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Exercise Breakdown</h3>
                        <div id="exercise-stats">
                            <p>Complete some workouts to see your exercise statistics!</p>
                        </div>
                    </div>
                </div>

                <!-- Community Page -->
                <div id="community-page" class="page">
                    <div class="page-header">
                        <h1>Community</h1>
                        <p>Connect with other fitness enthusiasts and join challenges.</p>
                    </div>

                    <div class="grid grid-2">
                        <div class="card">
                            <h3>Activity Feed</h3>
                            <div style="text-align: center; padding: 2rem; color: var(--text); opacity: 0.7;">
                                <p>üë• Community features coming soon!</p>
                                <p>Share your workouts and achievements with friends.</p>
                            </div>
                        </div>
                        <div class="card">
                            <h3>Active Challenges</h3>
                            <div style="text-align: center; padding: 2rem; color: var(--text); opacity: 0.7;">
                                <p>üéØ No active challenges</p>
                                <p>Join or create challenges to stay motivated!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Page -->
                <div id="achievements-page" class="page">
                    <div class="page-header">
                        <h1>Achievements</h1>
                        <p>Track your milestones and earn rewards for your dedication.</p>
                    </div>

                    <div class="card">
                        <h3>Your Points: <span id="user-points">0</span></h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="points-progress" style="width: 0%"></div>
                        </div>
                        <p>Next reward at 100 points</p>
                    </div>

                    <div class="grid grid-2">
                        <div class="achievement-badge">
                            <div class="badge-icon">üèÖ</div>
                            <div>
                                <h4>First Workout</h4>
                                <p>Complete your first workout session</p>
                                <small>Reward: 10 points</small>
                            </div>
                        </div>
                        <div class="achievement-badge">
                            <div class="badge-icon">üî•</div>
                            <div>
                                <h4>Week Warrior</h4>
                                <p>Complete 7 workouts in a week</p>
                                <small>Reward: 50 points</small>
                            </div>
                        </div>
                        <div class="achievement-badge">
                            <div class="badge-icon">üí™</div>
                            <div>
                                <h4>Strength Seeker</h4>
                                <p>Increase weight on any exercise</p>
                                <small>Reward: 25 points</small>
                            </div>
                        </div>
                        <div class="achievement-badge">
                            <div class="badge-icon">üìä</div>
                            <div>
                                <h4>Data Tracker</h4>
                                <p>Log 30 different exercises</p>
                                <small>Reward: 75 points</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Page -->
                <div id="profile-page" class="page">
                    <div class="page-header">
                        <h1>Profile Settings</h1>
                        <p>Customize your account and notification preferences.</p>
                    </div>

                    <div class="grid grid-2">
                        <div class="card">
                            <h3>Account Details</h3>
                            <form id="profile-form">
                                <div class="form-group">
                                    <label for="profile-name">Full Name</label>
                                    <input type="text" id="profile-name">
                                </div>
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="profile-age">Age</label>
                                    <input type="number" id="profile-age" min="13" max="120">
                                </div>
                                <div class="form-group">
                                    <label for="profile-weight">Weight (lbs)</label>
                                    <input type="number" id="profile-weight" min="50" max="500">
                                </div>
                                <button type="submit" class="btn">Update Profile</button>
                            </form>
                        </div>
                        <div class="card">
                            <h3>Notification Settings</h3>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="workout-reminders" checked>
                                    Daily workout reminders
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="achievement-notifications" checked>
                                    Achievement notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="community-updates">
                                    Community updates
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="reminder-time">Reminder Time</label>
                                <input type="time" id="reminder-time" value="08:00">
                            </div>
                            <button type="button" class="btn" onclick="saveNotificationSettings()">Save Settings</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Mock Database and Application State
        let appState = {
            currentUser: null,
            jwtToken: null,
            users: [
                {
                    id: 1,
                    email: "demo@fitness.com",
                    password: "$2a$10$hashedpassword123", // Simulated bcrypt hash
                    name: "Demo User",
                    age: 25,
                    weight: 150
                }
            ],
            workouts: [
                {
                    id: 1,
                    user_id: 1,
                    name: "Upper Body Strength",
                    exercises: [
                        {name: "Push-ups", sets: 3, reps: 15, weight: 0},
                        {name: "Pull-ups", sets: 3, reps: 8, weight: 0},
                        {name: "Bench Press", sets: 3, reps: 10, weight: 135}
                    ],
                    date: "2025-10-10"
                }
            ],
            currentPage: 'dashboard'
        };

        // Simulated Backend API
        class FitnessAPI {
            // Hash password (simplified simulation)
            static hashPassword(password) {
                return `$2a$10$${btoa(password + 'salt').slice(0, 22)}`;
            }

            // Generate JWT token (simplified simulation)
            static generateJWT(user) {
                const header = btoa(JSON.stringify({alg: 'HS256', typ: 'JWT'}));
                const payload = btoa(JSON.stringify({
                    id: user.id,
                    email: user.email,
                    exp: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                }));
                const signature = btoa(`signature_${user.id}`);
                return `${header}.${payload}.${signature}`;
            }

            // Verify JWT token
            static verifyJWT(token) {
                try {
                    const parts = token.split('.');
                    if (parts.length !== 3) return null;
                    
                    const payload = JSON.parse(atob(parts[1]));
                    if (payload.exp < Date.now()) return null;
                    
                    return payload;
                } catch (e) {
                    return null;
                }
            }

            // Register new user
            static async register(name, email, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Check if user already exists
                        const existingUser = appState.users.find(u => u.email === email);
                        if (existingUser) {
                            reject({ message: 'User already exists with this email' });
                            return;
                        }

                        // Create new user
                        const newUser = {
                            id: appState.users.length + 1,
                            email,
                            password: this.hashPassword(password),
                            name,
                            age: null,
                            weight: null
                        };

                        appState.users.push(newUser);
                        const token = this.generateJWT(newUser);
                        
                        resolve({ user: newUser, token });
                    }, 500);
                });
            }

            // Login user
            static async login(email, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const user = appState.users.find(u => u.email === email);
                        if (!user) {
                            reject({ message: 'Invalid email or password' });
                            return;
                        }

                        // Simulate password verification (in real app, use bcrypt.compare)
                        const hashedInput = this.hashPassword(password);
                        if (user.password !== hashedInput && !(user.email === 'demo@fitness.com' && password === 'demo123')) {
                            reject({ message: 'Invalid email or password' });
                            return;
                        }

                        const token = this.generateJWT(user);
                        resolve({ user, token });
                    }, 500);
                });
            }

            // Get user profile (protected route)
            static async getUserProfile(token) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const payload = this.verifyJWT(token);
                        if (!payload) {
                            reject({ message: 'Invalid or expired token', status: 401 });
                            return;
                        }

                        const user = appState.users.find(u => u.id === payload.id);
                        if (!user) {
                            reject({ message: 'User not found', status: 404 });
                            return;
                        }

                        // Don't send password in response
                        const { password, ...userProfile } = user;
                        resolve(userProfile);
                    }, 300);
                });
            }

            // Get user workouts (protected route)
            static async getUserWorkouts(token) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const payload = this.verifyJWT(token);
                        if (!payload) {
                            reject({ message: 'Invalid or expired token', status: 401 });
                            return;
                        }

                        const userWorkouts = appState.workouts.filter(w => w.user_id === payload.id);
                        resolve(userWorkouts);
                    }, 300);
                });
            }

            // Create new workout (protected route)
            static async createWorkout(token, workoutData) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const payload = this.verifyJWT(token);
                        if (!payload) {
                            reject({ message: 'Invalid or expired token', status: 401 });
                            return;
                        }

                        const newWorkout = {
                            id: appState.workouts.length + 1,
                            user_id: payload.id,
                            ...workoutData,
                            date: new Date().toISOString().split('T')[0]
                        };

                        appState.workouts.push(newWorkout);
                        resolve(newWorkout);
                    }, 500);
                });
            }
        }

        // Authentication Functions
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabs = document.querySelectorAll('.auth-tab');

            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            }

            clearMessages();
        }

        function showError(message) {
            const errorDiv = document.getElementById('auth-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            document.getElementById('auth-success').classList.add('hidden');
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('auth-success');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
            document.getElementById('auth-error').classList.add('hidden');
        }

        function clearMessages() {
            document.getElementById('auth-error').classList.add('hidden');
            document.getElementById('auth-success').classList.add('hidden');
        }

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearMessages();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging in...';

            try {
                const result = await FitnessAPI.login(email, password);
                appState.currentUser = result.user;
                appState.jwtToken = result.token;
                
                showMainApp();
            } catch (error) {
                showError(error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
            }
        });

        // Register form handler
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearMessages();

            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            if (password !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }

            if (password.length < 6) {
                showError('Password must be at least 6 characters long');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Account...';

            try {
                const result = await FitnessAPI.register(name, email, password);
                appState.currentUser = result.user;
                appState.jwtToken = result.token;
                
                showMainApp();
            } catch (error) {
                showError(error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Register';
            }
        });

        // Show main application after successful authentication
        function showMainApp() {
            document.getElementById('auth-page').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Update user welcome message
            document.getElementById('user-welcome').textContent = `Welcome, ${appState.currentUser.name}!`;
            
            // Load dashboard data
            loadDashboard();
            navigateTo('dashboard');
        }

        // Navigation function
        function navigateTo(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageName + '-page').classList.add('active');
            
            // Update sidebar navigation
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and highlight active navigation item
            const activeLink = document.querySelector(`.sidebar-nav a[onclick*="${pageName}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            appState.currentPage = pageName;
            
            // Load page-specific data
            if (pageName === 'workout-tracker') {
                loadWorkoutHistory();
            } else if (pageName === 'profile') {
                loadProfileData();
            }
        }

        // Load dashboard data with protected API call
        async function loadDashboard() {
            const profileLoading = document.getElementById('profile-loading');
            const profileContent = document.getElementById('profile-content');
            
            try {
                // Demonstrate protected API call
                const profile = await FitnessAPI.getUserProfile(appState.jwtToken);
                const workouts = await FitnessAPI.getUserWorkouts(appState.jwtToken);
                
                // Update stats
                document.getElementById('total-workouts').textContent = workouts.length;
                document.getElementById('current-streak').textContent = calculateStreak(workouts);
                document.getElementById('total-exercises').textContent = calculateTotalExercises(workouts);
                
                // Update recent workouts
                updateRecentWorkouts(workouts);
                
                profileLoading.classList.add('hidden');
                profileContent.classList.remove('hidden');
                
            } catch (error) {
                if (error.status === 401) {
                    // Token expired or invalid, redirect to login
                    logout();
                } else {
                    profileLoading.textContent = 'Error loading profile data';
                }
            }
        }

        // Helper functions for dashboard stats
        function calculateStreak(workouts) {
            if (workouts.length === 0) return 0;
            
            // Simple streak calculation (days with workouts)
            const workoutDates = workouts.map(w => w.date).sort();
            const today = new Date().toISOString().split('T')[0];
            
            // Check if there's a workout today or yesterday
            const lastWorkout = workoutDates[workoutDates.length - 1];
            const daysSinceLastWorkout = Math.floor((new Date(today) - new Date(lastWorkout)) / (1000 * 60 * 60 * 24));
            
            return daysSinceLastWorkout <= 1 ? Math.min(workouts.length, 7) : 0;
        }

        function calculateTotalExercises(workouts) {
            return workouts.reduce((total, workout) => {
                return total + (workout.exercises ? workout.exercises.length : 0);
            }, 0);
        }

        function updateRecentWorkouts(workouts) {
            const recentContainer = document.getElementById('recent-workouts');
            
            if (workouts.length === 0) {
                recentContainer.innerHTML = '<p>No recent workouts found. Start your fitness journey today!</p>';
                return;
            }
            
            const recentWorkouts = workouts.slice(-3).reverse();
            recentContainer.innerHTML = recentWorkouts.map(workout => `
                <div style="padding: 1rem; background: var(--background); border-radius: 5px; margin-bottom: 1rem;">
                    <h4>${workout.name}</h4>
                    <p>Date: ${workout.date}</p>
                    <p>Exercises: ${workout.exercises ? workout.exercises.length : 0}</p>
                </div>
            `).join('');
        }

        // Workout form functionality
        function addExercise() {
            const container = document.getElementById('exercises-container');
            const exerciseEntry = document.createElement('div');
            exerciseEntry.className = 'exercise-entry';
            exerciseEntry.innerHTML = `
                <div class="form-group">
                    <label>Exercise</label>
                    <select class="exercise-select" required>
                        <option value="">Select Exercise</option>
                        <option value="Push-ups">Push-ups</option>
                        <option value="Pull-ups">Pull-ups</option>
                        <option value="Bench Press">Bench Press</option>
                        <option value="Squats">Squats</option>
                        <option value="Deadlifts">Deadlifts</option>
                        <option value="Bicep Curls">Bicep Curls</option>
                        <option value="Shoulder Press">Shoulder Press</option>
                        <option value="Plank">Plank</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Sets</label>
                    <input type="number" class="sets-input" min="1" required>
                </div>
                <div class="form-group">
                    <label>Reps</label>
                    <input type="number" class="reps-input" min="1" required>
                </div>
                <div class="form-group">
                    <label>Weight (lbs)</label>
                    <input type="number" class="weight-input" min="0" step="0.5">
                </div>
                <button type="button" class="remove-exercise" onclick="removeExercise(this)">√ó</button>
            `;
            container.appendChild(exerciseEntry);
        }

        function removeExercise(button) {
            button.parentElement.remove();
        }

        // Workout form submission with protected API call
        document.getElementById('workout-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const workoutName = document.getElementById('workout-name').value;
            const exerciseEntries = document.querySelectorAll('.exercise-entry');
            const exercises = [];
            
            exerciseEntries.forEach(entry => {
                const exercise = entry.querySelector('.exercise-select').value;
                const sets = parseInt(entry.querySelector('.sets-input').value);
                const reps = parseInt(entry.querySelector('.reps-input').value);
                const weight = parseFloat(entry.querySelector('.weight-input').value) || 0;
                
                if (exercise && sets && reps) {
                    exercises.push({ name: exercise, sets, reps, weight });
                }
            });
            
            if (exercises.length === 0) {
                alert('Please add at least one exercise');
                return;
            }
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving Workout...';
            
            try {
                // Demonstrate protected POST request
                await FitnessAPI.createWorkout(appState.jwtToken, {
                    name: workoutName,
                    exercises: exercises
                });
                
                // Clear form
                document.getElementById('workout-form').reset();
                
                // Remove extra exercise entries
                const extraEntries = document.querySelectorAll('.exercise-entry:not(:first-child)');
                extraEntries.forEach(entry => entry.remove());
                
                alert('Workout saved successfully!');
                
                // Reload workout history
                loadWorkoutHistory();
                
            } catch (error) {
                if (error.status === 401) {
                    logout();
                } else {
                    alert('Error saving workout: ' + error.message);
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Workout';
            }
        });

        // Load workout history
        async function loadWorkoutHistory() {
            const historyContainer = document.getElementById('workout-history');
            historyContainer.innerHTML = '<div class="loading">Loading workout history...</div>';
            
            try {
                const workouts = await FitnessAPI.getUserWorkouts(appState.jwtToken);
                
                if (workouts.length === 0) {
                    historyContainer.innerHTML = '<p>No workouts found. Create your first workout!</p>';
                    return;
                }
                
                historyContainer.innerHTML = workouts.reverse().map(workout => `
                    <div style="padding: 1.5rem; background: var(--card-bg); border-radius: 10px; margin-bottom: 1rem; border: 1px solid var(--border);">
                        <h4>${workout.name}</h4>
                        <p><strong>Date:</strong> ${workout.date}</p>
                        <div style="margin-top: 1rem;">
                            <strong>Exercises:</strong>
                            <ul style="margin-top: 0.5rem; padding-left: 1rem;">
                                ${workout.exercises ? workout.exercises.map(ex => `
                                    <li>${ex.name} - ${ex.sets} sets √ó ${ex.reps} reps${ex.weight ? ` @ ${ex.weight} lbs` : ''}</li>
                                `).join('') : ''}
                            </ul>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                if (error.status === 401) {
                    logout();
                } else {
                    historyContainer.innerHTML = '<p>Error loading workout history</p>';
                }
            }
        }

        // Load profile data
        function loadProfileData() {
            if (appState.currentUser) {
                document.getElementById('profile-name').value = appState.currentUser.name || '';
                document.getElementById('profile-email').value = appState.currentUser.email || '';
                document.getElementById('profile-age').value = appState.currentUser.age || '';
                document.getElementById('profile-weight').value = appState.currentUser.weight || '';
            }
        }

        // Profile form handler
        document.getElementById('profile-form').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Profile updated successfully!');
        });

        // Notification settings
        function saveNotificationSettings() {
            alert('Notification settings saved successfully!');
        }

        // Logout function
        function logout() {
            appState.currentUser = null;
            appState.jwtToken = null;
            
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('auth-page').classList.remove('hidden');
            
            // Clear forms
            document.getElementById('login-form').reset();
            document.getElementById('register-form').reset();
            clearMessages();
        }

        // Check authentication status on page load (simulating token validation)
        function checkAuthStatus() {
            // In a real app, this would check localStorage and validate the JWT
            // For demo purposes, we'll start with the login page
            document.getElementById('auth-page').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });

        // Initialize achievements and points
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('user-points').textContent = '25';
            document.getElementById('points-progress').style.width = '25%';
        });
    </script>
</body>
</html>